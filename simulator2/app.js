import{BALL_RADIUS,CANVAS_SIZE,DESKTOP_CANVAS_SIZE,STARTING_BALLS,RUN,STATIC_PEOPLE_PERCENTATGE,STATES}from"./options.js";import{replayButton,deathFilter,stayHomeFilter,appPercentageSelect,appFailureRateSelect,appConformistsPercentageSelect}from"./dom.js";import{Ball}from"./Ball.js";import{resetValues,updateCount}from"./results.js";let balls=[];const matchMedia=window.matchMedia("(min-width: 800px)");let isDesktop=matchMedia.matches;export const canvas=new window.p5(e=>{const t=()=>{let t=0;balls=[],Object.keys(STARTING_BALLS).forEach(a=>{Array.from({length:STARTING_BALLS[a]},()=>{const s=!RUN.filters.stayHome||(e.random(0,100)<STATIC_PEOPLE_PERCENTATGE||a===STATES.infected),r=100*Math.random()<=RUN.filters.appPercentage;balls[t]=new Ball({id:t,sketch:e,state:a,hasMovement:s,hasApp:r,x:e.random(BALL_RADIUS,e.width-BALL_RADIUS),y:e.random(BALL_RADIUS,e.height-BALL_RADIUS)}),t++})})},a=()=>{const{height:t,width:a}=isDesktop?DESKTOP_CANVAS_SIZE:CANVAS_SIZE;e.createCanvas(a,t)};e.setup=()=>{a(),t(),matchMedia.addListener(e=>{isDesktop=e.matches,a(),t(),resetValues()}),replayButton.onclick=()=>{t(),resetValues()},deathFilter.onclick=()=>{RUN.filters.death=!RUN.filters.death,document.getElementById("death-count").classList.toggle("show",RUN.filters.death),t(),resetValues()},stayHomeFilter.onchange=()=>{RUN.filters.stayHome=!RUN.filters.stayHome,t(),resetValues()},appPercentageSelect.onchange=e=>{RUN.filters.appPercentage=parseInt(e.target.value),t(),resetValues()},appFailureRateSelect.onchange=e=>{RUN.filters.appFailurePercentage=parseInt(e.target.value),t(),resetValues()},appConformistsPercentageSelect.onchange=e=>{RUN.filters.autoIsolationPercentage=parseInt(e.target.value),t(),resetValues()}},e.draw=()=>{e.background("white"),balls.forEach(e=>{e.checkState(),e.checkCollisions({others:balls}),e.move(),e.render()}),updateCount()}},document.getElementById("canvas"));
